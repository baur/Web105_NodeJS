var url = require("url");
var route_handler = require("route_handler");

var route = {
	showHead: function(code) {
		this.response.writeHead(code,{"Content-Type":"text/html"})
	},
	write: function(data) {
		this.response.write(data);
	},
	end: function(){
		this.response.end();
	},
	init: function(request,response){
		this.request = request;
		this.response = response;
		this.route();
	},
	route: function(){

		var path = url.parse(this.request.url);
		var controller = path.pathname.replace(/\//g,"");
		var result = '';
		if (!controller) {
			result = route_handler.index();
			this.showHead(200);
			this.write(result);
			this.end();
			return;
		};

		if (typeof route_handler[controller] != 'function') {
			return this.error(404);
		}
		else {
			result = route_handler[controller]();
		}

		this.showHead(200);
		this.write(result);
		this.end();
		return;

	},
	error:function(code){
		this.showHead(code);
		this.write("<h1>Sorry error " + code+";( </h1>");
		this.end();
		return;
	}
}

module.exports.route = route;
